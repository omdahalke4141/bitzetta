version: 1
applications:
  - appRoot: .  # Assuming your app's root is the main directory
    backend:
      phases:
        preBuild:
          commands:
            - echo "Setting up Docker environment..."
            - docker build -t django-app .
        build:
          commands:
            - echo "Running Docker container..."
            - docker run -d -p 80:80 django-app
      artifacts:
        baseDirectory: productionfiles  # Make sure STATIC_ROOT matches this in settings.py
        files:
          - '**/*'
      cache:
        paths:
          - ~/.cache/pip  # Cache pip downloads for faster builds

    frontend:
      phases:
        preBuild:
          commands:
            - echo "No frontend specific pre-build steps needed"
        build:
          commands:
            - echo "No frontend specific build steps needed"
      artifacts:
        baseDirectory: productionfiles  # Align with backend artifacts
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*  # Cache node_modules if applicable

    customHeaders:
      - pattern: '**/*'
        headers:
          - key: "Cache-Control"
            value: "no-cache"
