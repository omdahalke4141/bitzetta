version: 1
applications:
  - appRoot: .  # Assuming your app's root is the main directory
    backend:
      phases:
        preBuild:
          commands:
            - echo "Setting up the environment and installing dependencies..."
            - python -m venv venv
            # Use cross-platform venv activation to handle different OS environments
            - source ./venv/bin/activate || .\\venv\\Scripts\\activate
            - pip install --upgrade pip
            - pip install -r requirements.txt  # Ensure this path is correct
        build:
          commands:
            - echo "Collecting static files..."
            - python manage.py collectstatic --noinput
            - echo "Running migrations..."
            - python manage.py migrate
      artifacts:
        baseDirectory: productionfiles  # Make sure STATIC_ROOT matches this in settings.py
        files:
          - '**/*'
      cache:
        paths:
          - ~/.cache/pip  # Cache pip downloads for faster builds

    frontend:
      phases:
        preBuild:
          commands:
            - echo "No frontend specific pre-build steps needed"
        build:
          commands:
            - echo "No frontend specific build steps needed"
      artifacts:
        baseDirectory: static # Align with backend artifacts
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*  # Cache node_modules if applicable