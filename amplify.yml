version: 1
applications:
  - appRoot: toi  # Correct the path to point to the app's root directory
    backend:
      phases:
        preBuild:
          commands:
            - echo "Setting up the environment and installing dependencies..."
            - python -m venv venv
            - source ./venv/bin/activate || .\\venv\\Scripts\\activate  # Cross-platform activation
            - pip install --upgrade pip
            - pip install -r requirements.txt
        build:
          commands:
            - echo "Collecting static files..."
            - python manage.py collectstatic --noinput
            - echo "Running migrations..."
            - python manage.py migrate
      artifacts:
        # Ensure the baseDirectory matches the STATIC_ROOT or other output directory
        baseDirectory: staticfiles  # Change this if static files are placed elsewhere
        files:
          - '**/*'
      cache:
        paths:
          - ~/.cache/pip
    frontend:
      phases:
        preBuild:
          commands:
            - echo "No frontend specific pre-build steps needed"
        build:
          commands:
            - echo "No frontend specific build steps needed"
      artifacts:
        # If there's a frontend build, specify the correct output directory here
        baseDirectory: staticfiles  # Adjust if frontend assets are different
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*